<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#121212">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Crypto Futures TradeMath</title>
    <link rel="manifest" href="./manifest.json">
    <link rel="icon" type="image/png" href="./icons/icon-192.png">
    <link rel="apple-touch-icon" href="./icons/icon-192.png">
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <noscript>
        <div style="background:#121212;color:#fff;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;text-align:center;">
            <div>
                <h1 style="color:#00D9A3;">Crypto Futures TradeMath</h1>
                <p>JavaScript diperlukan untuk menjalankan aplikasi ini.</p>
            </div>
        </div>
    </noscript>

    <div id="loading-fallback" style="background:#121212;color:#fff;min-height:100vh;display:flex;align-items:center;justify-content:center;">
        <div style="text-align:center;">
            <div style="width:48px;height:48px;border:3px solid #1A1D29;border-top-color:#00D9A3;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 16px;"></div>
            <p style="color:#8B92A7;">Loading...</p>
        </div>
    </div>
    <style>@keyframes spin{to{transform:rotate(360deg)}}</style>

    <div id="app" style="display:none;">
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <div class="header-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="4" y="2" width="16" height="20" rx="2"/>
                            <line x1="8" y1="6" x2="16" y2="6"/>
                            <line x1="16" y1="14" x2="16" y2="18"/>
                            <path d="M8 10h.01M12 10h.01M16 10h.01M8 14h.01M12 14h.01M8 18h.01M12 18h.01"/>
                        </svg>
                    </div>
                    <h1 class="header-title">Crypto Futures TradeMath</h1>
                </div>
                <button id="nav-history" class="nav-btn">
                    History
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/>
                    </svg>
                </button>
            </div>
        </header>

        <main id="page-calculator" class="page active">
            <div class="main-content">
                <div id="persistent-warning" style="background: rgba(255, 184, 0, 0.1); border: 1px solid rgba(255, 184, 0, 0.3); border-radius: 8px; padding: 12px; margin-bottom: 20px; color: #FFB800; font-size: 14px; text-align: center;">
                    ⚠️ Attention! Make sure you already have a trade plan before using this calculator.
                </div>
                <div class="grid-layout">
                    <div class="input-section">
                        <div class="card">
                            <div class="card-header">
                                <span class="card-title">Parameters</span>
                            </div>
                            <div class="card-body">
                                <div class="input-row">
                                    <div class="input-group">
                                        <label class="input-label">Account Balance</label>
                                        <div class="input-wrapper">
                                            <input type="text" id="totalCapital" class="input-field" placeholder="0" inputmode="decimal">
                                            <span class="input-suffix">$</span>
                                        </div>
                                    </div>
                                    <div class="input-group" id="risk-input-group">
                                        <label class="input-label">Risk</label>
                                        <div class="input-with-select">
                                            <input type="text" id="maxRisk" class="input-field input-risk" placeholder="0" inputmode="decimal">
                                            <select id="riskUnitSelect" class="unit-select">
                                                <option value="$">$</option>
                                                <option value="%" selected>%</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="input-row">
                                    <div class="input-group">
                                        <label class="input-label">Leverage</label>
                                        <div class="input-wrapper">
                                            <input type="text" id="leverage" class="input-field" placeholder="0" inputmode="decimal">
                                            <span class="input-suffix">x</span>
                                        </div>
                                    </div>
                                    <div class="input-group">
                                        <label class="input-label">Entry Price</label>
                                        <div class="input-wrapper">
                                            <input type="text" id="entryPrice" class="input-field" placeholder="0" inputmode="decimal">
                                        </div>
                                    </div>
                                </div>

                                <div class="input-row">
                                    <div class="input-group">
                                        <label class="input-label">Stop Loss</label>
                                        <div class="input-wrapper input-danger">
                                            <input type="text" id="stopLoss" class="input-field" placeholder="0" inputmode="decimal">
                                        </div>
                                    </div>
                                    <div class="input-group">
                                        <label class="input-label">Take Profit</label>
                                        <div class="input-wrapper input-success">
                                            <input type="text" id="takeProfit" class="input-field" placeholder="0" inputmode="decimal">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="results-section">
                        <div id="warning-banner" class="warning-banner" style="display:none;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
                            </svg>
                            <div class="warning-content">
                                <strong>Liquidation Risk</strong>
                                <span id="warning-text"></span>
                            </div>
                        </div>

                        <div id="empty-state" class="empty-state">
                            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/>
                            </svg>
                            <p class="empty-title">Enter trade parameters to see analysis</p>
                            <p class="empty-subtitle">Real-time risk calculations, liquidation checks, and position sizing.</p>
                        </div>

                        <div id="trade-direction" style="display:none; text-align:center; margin-bottom: 16px;">
                            <div style="display: flex; justify-content: center; align-items: center; gap: 16px;">
                                <span style="font-size: 11px; text-transform: uppercase; letter-spacing: 1px; opacity: 0.7;">Type of Trade</span>
                                <div id="long-box" style="display: flex; align-items: center; gap: 8px; padding: 12px 24px; border-radius: 12px; font-weight: bold; transition: all 0.3s;">
                                    <span style="font-size: 18px;">↑</span>
                                    <span style="font-size: 18px;">LONG</span>
                                </div>
                                <div id="short-box" style="display: flex; align-items: center; gap: 8px; padding: 12px 24px; border-radius: 12px; font-weight: bold; transition: all 0.3s;">
                                    <span style="font-size: 18px;">↓</span>
                                    <span style="font-size: 18px;">SHORT</span>
                                </div>
                            </div>
                        </div>

                        <div id="results-grid" class="results-grid" style="display:none;">
                            <div class="stat-card">
                                <span class="stat-label">Margin Cost</span>
                                <span id="stat-margin" class="stat-value">$0.00</span>
                                <span id="stat-margin-sub" class="stat-subtext">0% of Account Balance</span>
                            </div>
                            <div class="stat-card stat-danger">
                                <span class="stat-label">Risk Amount</span>
                                <span id="stat-risk" class="stat-value">-$0.00</span>
                                <span id="stat-risk-sub" class="stat-subtext">0% of Account Balance</span>
                            </div>
                            <div class="stat-card stat-success">
                                <span class="stat-label">Potential Profit</span>
                                <span id="stat-profit" class="stat-value">+$0.00</span>
                                <span id="stat-profit-sub" class="stat-subtext">0% of Account Balance Gain</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">R:R Ratio</span>
                                <span id="stat-rr" class="stat-value">1:0</span>
                                <span id="stat-rr-sub" class="stat-subtext">-</span>
                            </div>
                            <div class="stat-card stat-success">
                                <span class="stat-label">Return on Margin Cost</span>
                                <span id="stat-roe" class="stat-value">0%</span>
                                <span id="stat-roe-sub" class="stat-subtext">Return on Equity (ROE)</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">Amount of Position (USDT)</span>
                                <span id="stat-position" class="stat-value">$0.00</span>
                                <span id="stat-position-sub" class="stat-subtext">Total Position Size</span>
                            </div>
                            <div id="stat-liq-isolated" class="stat-card stat-warning stat-liq-card">
                                <span class="stat-label">Est. Liq Price (Isolated)</span>
                                <span id="stat-liq-isolated-value" class="stat-value">$0</span>
                                <span id="stat-liq-isolated-sub" class="stat-subtext">Isolated Margin Liquidation</span>
                            </div>
                            <div id="stat-liq-cross" class="stat-card stat-warning stat-liq-card">
                                <span class="stat-label">Est. Liq Price (Cross)</span>
                                <span id="stat-liq-cross-value" class="stat-value">$0</span>
                                <span id="stat-liq-cross-sub" class="stat-subtext">Cross Margin Liquidation</span>
                            </div>
                        </div>

                        <div id="footer-actions" style="display: flex; justify-content: flex-end; gap: 12px; width: 100%; margin-top: 15px; box-sizing: border-box;">
                            <button type="button" id="btn-reset-mobile" class="btn btn-secondary" style="width: auto; padding: 10px 24px; font-size: 14px; font-weight: 600; border-radius: 8px; cursor: pointer; background: rgba(255,255,255,0.1); color: #fff; border: none;">Reset</button>
                            <button type="button" id="btn-save-mobile" class="btn btn-primary" style="width: auto; padding: 10px 24px; font-size: 14px; font-weight: 600; border-radius: 8px; cursor: pointer; background: #00D9A3; color: #121212; border: none;" disabled>Save</button>
                        </div>

                    </div>
                </div>
            </div>
        </main>

        <main id="page-history" class="page">
            <div class="main-content">
                <div class="history-header">
                    <button id="nav-back" class="back-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/>
                        </svg>
                    </button>
                    <h2 class="page-title">Trade History</h2>
                    <button id="btn-clear-history" class="clear-btn" style="display:none;">Clear All</button>
                </div>

                <div id="history-empty" class="history-empty">
                    <div class="history-empty-icon">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                        </svg>
                    </div>
                    <h3>No history yet</h3>
                    <p>Calculate and save your first trade plan.</p>
                    <button id="btn-go-calc" class="btn btn-primary">Go to Calculator</button>
                </div>

                <div id="history-list" class="history-list"></div>
            </div>
        </main>

        <div id="toast" class="toast" style="display:none;">
            <span id="toast-message"></span>
        </div>
    </div>

    <script src="./app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registered');
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed');
                    });
            });
        }
    </script>

</body>
</html>
